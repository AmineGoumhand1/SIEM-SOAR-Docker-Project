# 05-cassandra.yaml
# apiVersion: apps/v1
# kind: StatefulSet
# metadata:
#   name: cassandra
#   namespace: soc-platform
# spec:
#   serviceName: cassandra
#   replicas: 1
#   selector:
#     matchLabels:
#       app: cassandra
#   template:
#     metadata:
#       labels:
#         app: cassandra
#     spec:
#       containers:
#       - name: cassandra
#         image: cassandra:4
#         ports:
#         - containerPort: 9042
#         - containerPort: 7000
#         - containerPort: 7001
#         env:
#         - name: CASSANDRA_CLUSTER_NAME
#           value: "TheHive"
#         - name: CASSANDRA_START_RPC
#           value: "true"
#         - name: MAX_HEAP_SIZE
#           value: "512M"
#         - name: HEAP_NEWSIZE
#           value: "100M"
#         resources:
#           requests:
#             memory: "1Gi"
#             cpu: "500m"
#           limits:
#             memory: "2Gi"
#             cpu: "1000m"
#         volumeMounts:
#         - name: cassandra-data
#           mountPath: /var/lib/cassandra
#         livenessProbe:
#           exec:
#             command:
#             - /bin/bash
#             - -c
#             - "cqlsh -e 'describe cluster'"
#           initialDelaySeconds: 60
#           periodSeconds: 30
#         readinessProbe:
#           exec:
#             command:
#             - /bin/bash
#             - -c
#             - "cqlsh -e 'describe cluster'"
#           initialDelaySeconds: 30
#           periodSeconds: 10
#   volumeClaimTemplates:
#   - metadata:
#       name: cassandra-data
#     spec:
#       accessModes: [ "ReadWriteOnce" ]
#       storageClassName: soc-storage
#       resources:
#         requests:
#           storage: 10Gi
# ---
# apiVersion: v1
# kind: Service
# metadata:
#   name: cassandra
#   namespace: soc-platform
# spec:
#   ports:
#   - name: cql
#     port: 9042
#     targetPort: 9042
#   - name: intra-node
#     port: 7000
#     targetPort: 7000
#   - name: tls-intra-node
#     port: 7001
#     targetPort: 7001
#   selector:
#     app: cassandra
#   clusterIP: None